<html>
  <head>
    <title>Open Data Sets in Waterloo Region</title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
    <!--[if lte IE 8]>
      <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
    <![endif]-->
    <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <style>
      #map {  height: 100%;
              margin: 0px;
              /*width:75%;*/
           }
      .leaflet-popup-content table {
        border-collapse:collapse;
      }
      .leaflet-popup-content tr:nth-child(even) {background: #f7f7f7}
      .leaflet-popup-content tr:nth-child(odd) {background: #FFF}
      .leaflet-popup-content td,
      .leaflet-popup-content th {
        padding: 5px 10px;
        border-color: #eee;
        border-width: 1px;
        border-style: solid;
        font-size: 11px;}
      .info {
          padding: 6px 8px;
          font: 14px/16px Arial, Helvetica, sans-serif;
          background: white;
          background: rgba(255,255,255,0.8);
          box-shadow: 0 0 15px rgba(0,0,0,0.2);
          border-radius: 5px;
      }
      .info h4 {
          margin: 0 0 5px;
          color: #777;
      }
      .legend {
          line-height: 18px;
          color: #555;
      }
      .legend i {
          width: 18px;
          height: 18px;
          float: left;
          margin-right: 8px;
          opacity: 0.7;
      }
      .titleDiv {
        text-shadow: 2px 2px #FFF;
        font: 24px Arial, Helvetica, sans-serif bold;
      }
    </style>
    
    <script>
      function onEachFeature(feature, layer) {
        // does this feature have a property named popupContent?
        if (feature.properties) {
          html = '<table>'
          $.each(feature.properties, function( k, v ) {
            html += '<tr><th>' + k + '</td><td>' + v + '</td></tr>';
          });
          html+= '</table>';
          layer.bindPopup(html, {closeButton:false});
        }
      }
        
      $(document).ready(function(){
        var map = L.map('map', {
          center: [43.452763, -80.484453],
          zoom: 13,
          maxBounds: [[43.2615,-80.8698],[43.7,-80.161]]});
        
        L.tileLayer('http://maps.tritag.ca/bike/{z}/{x}/{y}.png', {
            attribution: 'Base map &copy; <a href="http://openstreetmap.org">OpenStreetMap contributors, ODbL</a> | Website created by <a href="http://real.uwaterloo.ca/~mboos">Mike Boos</a>',
            minZoom: 10
        }).addTo(map);
        
        L.control.scale().addTo(map);
        
        var legend = L.control({position: 'bottomright'});

        legend.onAdd = function (map) {
        
            var div = L.DomUtil.create('div', 'info legend');
            
            /*datasets.map(function(dataset) {
              div.innerHTML += '<input type="checkbox" id="' +
                dataset.ref + '" name="a" value="b"/><a href="' +
                dataset.href + '">' + dataset.name + '</a><br/>'
              
            });*/
            //div.innerHTML += '* <small>Contains information licensed under<br/>the Open Government Licence - Ontario.</small>'
            
            return div;
        };
        
        legend.addTo(map);
        
        var title = L.control({position: 'topright'});
        title.onAdd = function(map) {
          var div = L.DomUtil.create('div', 'titleDiv');
          div.innerHTML += 'Census Transportation Mode Data';
          return div
        }
        title.addTo(map);
        
        var layer;
        $.getJSON('census_transp.topojson', function(data) {
          geodata = topojson.feature(data, data.objects['census_transp.shp']);
          layer = L.geoJson(geodata, {style: function(feature) {
              return {fillOpacity: 2.0 * feature.TransitShare, weight: 0};
            }});
          layer.addTo(map);
        });
        
        /*datasets.map(function(dataset) {
          $('#'+dataset.ref).change(function() {
            if (this.checked) {
              if (dataset.layer) {
                dataset.layer.addTo(map);
              } else {
                $.getJSON(dataset.url, function(data) {
                  dataset.data = data;
                  if (dataset.url.indexOf('topojson') > 0) {
                    geodata = topojson.feature(data, data.objects[dataset.ref]);
                  } else {
                    geodata = data
                  }
                  if (dataset.icon) {
                    dataset.layer = L.geoJson(geodata, {
                      style: dataset.style,
                      pointToLayer: function(feature, latlng) {
                        return L.marker(latlng, {icon:
                                        L.icon({ iconUrl: dataset.icon(feature),
                                                iconSize: [12, 12],
                                                iconAnchor: [6, 6],
                                                popupAnchor: [0, -7],})
                                        });
                      },
                      onEachFeature: onEachFeature}).addTo(map);
                  } else {
                    dataset.layer = L.geoJson(geodata, {
                      style: dataset.style,
                      onEachFeature: onEachFeature}).addTo(map);
                  }
                });
              }
            } else {
              map.removeLayer(dataset.layer);
            }
          });
        });*/
      });
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-40829251-1', 'mboos.github.io');
      ga('send', 'pageview');
    
    </script>
  </head>
  <body>
    <div id='map'></div>
  </body>
</html>
